<!DOCTYPE html>
<html>
<head>
    <title>Author a Story with N3</title>
    <link rel="stylesheet" href="css/jquery-ui.css" type="text/css" />
    <link rel="stylesheet" href="css/colorpicker.css" type="text/css" />
    <link rel="stylesheet" href="css/n3-edit.css" type="text/css" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/jquery.json-2.3.min.js"></script>
    <script type="text/javascript" src="js/colorpicker.js"></script>
    <script type="text/javascript" src="js/d3.min.js"></script>
    <script type="text/javascript" src="js/n3.js"></script>
    <script type="text/javascript" src="js/n3-edit.js"></script>
    <style>
    svg {
        float: left;
        width: 700px;
        height: 400px;
        border: 1px solid grey;
        background: #edf1f7;
    }
    
    #explanation { 
        float: left; 
        width: 200px;
        margin-right: 50px;
        height: 500px; 
    }
    
    #slider {
        float: left;
        width: 700px;
        margin-top: 20px;
    }
    
    path#zero {
        stroke: grey;
        stroke-width: 1;
    }
    
    path.forecast {
        stroke: steelblue;
        stroke-width: 0.5;
        fill: none;
    }
    
    path#actual {
        stroke: steelblue;
        stroke-width: 3;
        fill: none;
    }
    
    path#projected {
        stroke: grey;
        stroke-width: 3;
        fill: none;        
    }
        
    circle.annotation { 
        opacity: 0.5; 
        fill: orange;
        stroke: orange;
    }
    
    circle.point {
        fill: grey;
        stroke: grey;
    }
    
    span.annotation { color: #999; }
    </style>
</head>
<body>
    <div id="n3-ui_visDialog" title="Visualizations">
    	<p>To begin, please paste your javascript <code>n3.vis</code> wrappers in the textbox below. Feel free to enter multiple visualizations at once.</p>
    	<p><textarea name="vis" id="vis">
    	    var fullData = [
            	{
            		"1980": -103,
            		"1981": -37,
            		"1982": 10,
            		"1983": 51,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1980"
            	},
            	{
            		"1980": -192,
            		"1981": -129,
            		"1982": -60,
            		"1983": -17,
            		"1984": 63,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1981"
            	},
            	{
            		"1980": 0,
            		"1981": -185,
            		"1982": -215,
            		"1983": -190,
            		"1984": -164,
            		"1985": -137,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1982"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": -280,
            		"1983": -432,
            		"1984": -373,
            		"1985": -371,
            		"1986": -275,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1983"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": -432,
            		"1984": -363,
            		"1985": -345,
            		"1986": -330,
            		"1987": -326,
            		"1988": -267,
            		"1989": -209,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1984"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": -367,
            		"1985": -425,
            		"1986": -336,
            		"1987": -298,
            		"1988": -253,
            		"1989": -182,
            		"1990": -135,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1985"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": -406,
            		"1986": -378,
            		"1987": -260,
            		"1988": -164,
            		"1989": -114,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1986"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": -412,
            		"1987": -313,
            		"1988": -189,
            		"1989": -157,
            		"1990": -98,
            		"1991": -33,
            		"1992": 19,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1987"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": -271,
            		"1988": -257,
            		"1989": -219,
            		"1990": -166,
            		"1991": -124,
            		"1992": -77,
            		"1993": -34,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1988"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": -272,
            		"1989": -273,
            		"1990": -152,
            		"1991": -105,
            		"1992": -49,
            		"1993": -4,
            		"1994": 48,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1989"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": -258,
            		"1990": -203,
            		"1991": -99,
            		"1992": -38,
            		"1993": 8,
            		"1994": 15,
            		"1995": 13,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1990"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": -363,
            		"1991": -499,
            		"1992": -424,
            		"1993": -296,
            		"1994": -89,
            		"1995": 4,
            		"1996": 27,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1991"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": -422,
            		"1992": -603,
            		"1993": -514,
            		"1994": -306,
            		"1995": -272,
            		"1996": -249,
            		"1997": -252,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1992"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": -438,
            		"1993": -465,
            		"1994": -367,
            		"1995": -323,
            		"1996": -258,
            		"1997": -243,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1993"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": -375,
            		"1994": -339,
            		"1995": -232,
            		"1996": -233,
            		"1997": -250,
            		"1998": -253,
            		"1999": -238,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1994"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": -293,
            		"1995": -270,
            		"1996": -270,
            		"1997": -286,
            		"1998": -261,
            		"1999": -259,
            		"2000": -249,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1995"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": -230,
            		"1996": -200,
            		"1997": -188,
            		"1998": -130,
            		"1999": -84,
            		"2000": -35,
            		"2001": 10,
            		"2002": 54,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1996"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": -147,
            		"1997": -169,
            		"1998": -160,
            		"1999": -154,
            		"2000": -112,
            		"2001": -45,
            		"2002": 21,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1997"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": -29,
            		"1998": -13,
            		"1999": 12,
            		"2000": 11,
            		"2001": 35,
            		"2002": 110,
            		"2003": 98,
            		"2004": 127,
            		"2005": 153,
            		"2006": 178,
            		"2007": 228,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1998"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 92,
            		"1999": 104,
            		"2000": 150,
            		"2001": 167,
            		"2002": 229,
            		"2003": 218,
            		"2004": 242,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "1999"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 165,
            		"2000": 214,
            		"2001": 230,
            		"2002": 229,
            		"2003": 221,
            		"2004": 227,
            		"2005": 241,
            		"2006": 277,
            		"2007": 308,
            		"2008": 320,
            		"2009": 334,
            		"2010": 363,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2000"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 302,
            		"2001": 351,
            		"2002": 284,
            		"2003": 290,
            		"2004": 305,
            		"2005": 302,
            		"2006": 331,
            		"2007": 359,
            		"2008": 380,
            		"2009": 427,
            		"2010": 465,
            		"2011": 519,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2001"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 160,
            		"2002": -130,
            		"2003": -96,
            		"2004": -16,
            		"2005": 68,
            		"2006": 93,
            		"2007": 110,
            		"2008": 0,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2002"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": -194,
            		"2003": -364,
            		"2004": -357,
            		"2005": -233,
            		"2006": -218,
            		"2007": -188,
            		"2008": -193,
            		"2009": 0,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2003"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": -452,
            		"2004": -606,
            		"2005": -409,
            		"2006": -290,
            		"2007": -254,
            		"2008": -243,
            		"2009": -241,
            		"2010": 0,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2004"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": -480,
            		"2005": -479,
            		"2006": -423,
            		"2007": -329,
            		"2008": -255,
            		"2009": -237,
            		"2010": -207,
            		"2011": 0,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2005"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": -357,
            		"2006": -458,
            		"2007": -373,
            		"2008": -227,
            		"2009": -211,
            		"2010": -183,
            		"2011": -202,
            		"2012": 0,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2006"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": -269,
            		"2007": -257,
            		"2008": -240,
            		"2009": -190,
            		"2010": -94,
            		"2011": -53,
            		"2012": 59,
            		"2013": 0,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2007"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": -170,
            		"2008": -417,
            		"2009": -414,
            		"2010": -160,
            		"2011": -94,
            		"2012": 47,
            		"2013": 28,
            		"2014": 0,
            		"2015": 0,
            		"2016": 0,
            		"2017": 0,
            		"2018": 0,
            		"2019": 0,
            		"2020": 0,
            		"year": "2008"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": -467,
            		"2009": -1781,
            		"2010": -1171,
            		"2011": -899,
            		"2012": -563,
            		"2013": -507,
            		"2014": -532,
            		"2015": -534,
            		"2016": -573,
            		"2017": -562,
            		"2018": -551,
            		"2019": -607,
            		"2020": 0,
            		"year": "2009"
            	},
            	{
            		"1980": 0,
            		"1981": 0,
            		"1982": 0,
            		"1983": 0,
            		"1984": 0,
            		"1985": 0,
            		"1986": 0,
            		"1987": 0,
            		"1988": 0,
            		"1989": 0,
            		"1990": 0,
            		"1991": 0,
            		"1992": 0,
            		"1993": 0,
            		"1994": 0,
            		"1995": 0,
            		"1996": 0,
            		"1997": 0,
            		"1998": 0,
            		"1999": 0,
            		"2000": 0,
            		"2001": 0,
            		"2002": 0,
            		"2003": 0,
            		"2004": 0,
            		"2005": 0,
            		"2006": 0,
            		"2007": 0,
            		"2008": 0,
            		"2009": -1436,
            		"2010": -1556,
            		"2011": -1250,
            		"2012": -803,
            		"2013": -692,
            		"2014": -659,
            		"2015": -689,
            		"2016": -700,
            		"2017": -688,
            		"2018": -682,
            		"2019": -775,
            		"2020": -841,
            		"year": "2010"
            	}
            ];
            
            var vis = n3.vis('budgetForecast') 
                .data(fullData)

                .stage('#stage', 700, 400)

                .state('year', d3.range(1980, 2011))
                .state('plotForecasts', [true, false])

                .const('minYear', 1980)
                .const('maxYear', 2010)
                .const('maxYearForecast', 2020)
                .const('minValue', -1781)
                .const('maxValue', 519)

                .const('sx', function() {
                    return d3.scale.linear()
                                    .domain([vis.const('minYear'), vis.const('maxYearForecast')])
                                    .range([0, vis.width()]);
                })

                .const('sy', function() {
                  return d3.scale.linear()
                                    .domain([vis.const('minValue'), vis.const('maxValue')])
                                    .range([vis.height(), 0]);  
                })

                .const('drawLineGraph', function() {
                    return d3.svg.line()
                                        .x(function(d, i){ return vis.const('sx')()(d.year); })
                                        .y(function(d, i){ return vis.const('sy')()(d.val); });
                })

                .const('dataTransform', function(year, val) {
                    return {'year': year, 'val': val};
                })

                .render(function() {
                    // First draw zero line
                    drawAxes(this);

                    // Plot forecasts
                    drawForecasts(this);

                    // Plot actual budget figures
                    drawActual(this);
                });

            function drawAxes(vis) {
                var sx = vis.const('sx')();
                var sy = vis.const('sy')();

                var formatNumber = function(nStr) {
                    nStr += '';
                	x = nStr.split('.');
                	x1 = x[0];
                	x2 = x.length > 1 ? '.' + x[1] : '';
                	var rgx = /(\d+)(\d{3})/;
                	while (rgx.test(x1)) {
                		x1 = x1.replace(rgx, '$1' + '.' + '$2');
                	}

                	var newStr = x1 + x2;
                	if(newStr.indexOf('-') != -1) {
                	    newStr = '-$' + newStr.substring(1);
                	} else {
                	    newStr = '$' + newStr;
                	}

                	return newStr;
                }

                var xAxis = d3.range(vis.const('minYear'), vis.const('maxYearForecast'), 2); 
                var yAxis = d3.range(vis.const('minValue'), vis.const('maxValue'), 200);

                vis.stage()
                    .selectAll('line.xAxis')
                    .data(xAxis)
                    .enter()
                        .append("svg:line")
                        .attr("x1", function(d) { return sx(d); })
                        .attr("y1", function() { return vis.height() + 20 })
                        .attr("x2", function(d) { return sx(d); })
                        .attr("y2", 0)
                        .attr("stroke", "#fff")
                        .attr("class", "xAxis");

                vis.stage()
                    .selectAll("line.yAxis")
                    .data(yAxis)
                    .enter()
                        .append("svg:line")
                        .attr("x1", -20)
                        .attr("y1", function(d) { return sy(d); })
                        .attr("x2", function(d) { return vis.width() + 20 })
                        .attr("y2", function(d) { return sy(d); })
                        .attr("stroke", "#fff")
                        .attr("class", "yAxis");

                vis.stage()
                    .selectAll("text.xAxisLabels")
                    .data(xAxis)
                    .enter()
                        .append("svg:text")
                        .text(function(d) { 
                            if(d == vis.const('minYear') || d == vis.const('maxYearForecast')) 
                                return;

                            var fullYear = d + '';
                            return "'" + fullYear.substring(2); 
                        })
                        .attr("x", function(d) { return sx(d); })
                        .attr("dx", "10")
                        .attr("y", function(d) { return sy(0); })
                        .attr("dy", "-5")
                        .attr("class", "xAxisLabels")
                        .attr("fill", "#aaa")
                        .attr("text-anchor", "end");        

                vis.stage()
                    .selectAll("text.yAxisLabels")
                    .data(yAxis)
                    .enter()
                        .append("svg:text")
                        .text(function(d) {
                            if(d != 19 && d != vis.const('minValue'))
                                return formatNumber(Math.round(d)) + ((Math.abs(d) > 1000) ? ' trillion' : ' billion'); 
                        })
                        .attr("x", 75)
                        .attr("dx", function(d) { return Math.abs(d) > 1000 ? 15 : 0 })
                        .attr("y", function(d) { return sy(d); })
                        .attr("dy", "4")
                        .attr("class", "yAxisLabels")
                        .attr("fill", "#aaa")
                        .attr("text-anchor", "end");

                var zeroData = [];
                for(var i = vis.const('minYear'); i <= vis.const('maxYearForecast'); i++)
                    zeroData[zeroData.length] = vis.const('dataTransform')(i, 0);

                var path = vis.stage().selectAll('path#zero')
                                    .data([zeroData]);

                path.enter()
                    .append('svg:path')
                    .attr('id', 'zero')
                    .attr('d', vis.const('drawLineGraph')());
            }

            function drawForecasts(vis) {
                var plot = vis.state('plotForecasts');
                var year = vis.state('year');
                var drawLineGraph = vis.const('drawLineGraph')();
                var dataTransform = vis.const('dataTransform');
                var fullData = vis.data();

                var data = [];    

                if(plot == 'true') {
                    for(var i in fullData) {    // fullData is already sorted by year
                        var d = fullData[i];
                        if(d.year > year)
                            break;

                        var forecastData = [];
                        var forecastYears = d3.keys(d);
                        for (j in forecastYears) {
                            var fy = forecastYears[j];
                            if(fy == 'year' || d[fy] == 0)
                                continue;

                            forecastData[forecastData.length] = dataTransform(fy, d[fy]);                
                        }

                        data[data.length] = forecastData;
                    }        
                }

                var forecast = vis.stage().selectAll('path.forecast')
                                        .data(data);

                forecast.enter()
                            .append('svg:path')
                            .attr('d', drawLineGraph)
                            .attr('class', 'forecast');

                forecast.transition()
                            .attr('d', drawLineGraph)

                forecast.exit()
                            .remove();    
            }

            function drawActual(vis) {
                var year = vis.state('year');
                var drawLineGraph = vis.const('drawLineGraph')();
                var dataTransform = vis.const('dataTransform');
                var fullData = vis.data();

                var data = [];

                for (i in fullData) {
                    var d = fullData[i];
                    if(d.year > year)
                        continue;

                    var prevYear = d.year - 1;

                    data[data.length] = dataTransform(prevYear, (d[prevYear] || 0));
                }

                var actual = vis.stage().selectAll('path#actual')
                                        .data([data]);

                actual.enter()
                            .append('svg:path')
                            .attr('d', drawLineGraph)
                            .attr('id', 'actual');

                actual.transition().attr('d', drawLineGraph);

                actual.exit().remove();

                // 2010 projection
                var projectedData = [];    
                if(year >= 2010) {
                    var d2010 = fullData[fullData.length - 1];
                    var years = d3.keys(d2010);

                    for (i in years) {
                        var y = years[i];

                        if(y == 'year' || d2010[y] == 0)
                            continue;

                        projectedData[projectedData.length] = dataTransform(y, d2010[y]);                
                    }   
                }

                var projected = vis.stage()
                                        .selectAll('path#projected')
                                        .data([projectedData]);

                projected.enter()
                            .append('svg:path')
                            .attr('d', drawLineGraph)
                            .attr('id', 'projected');

                projected.transition().attr('d', drawLineGraph);

                projected.exit().remove();
            }
    	</textarea></p>
    </div>
        
    <div id="n3-ui_stage">
        
    </div>
    
    <div id="n3-ui_bottom_panel">
        <input type="button" class="new button-left button" name="n3-ui_startScene" value="New Scene" id="n3-ui_startScene" onclick="editScene();" />
        
        <input type="button" class="end button-left button" name="n3-ui_endScene" value="End Scene" id="n3-ui_endScene" onclick="endScene();" style="display: none;" />
        
        <div id="n3-ui_palette" style="display: none;">
            <a href="#" onclick="toggleShape(this, SHAPES.ELLIPSE);" class="circle">Draw Circle</a>
            <!-- <a href="#" onclick="toggleShape(this, SHAPES.ELLIPSE);"><img src="imgs/draw-ellipse.png" src="Draw Ellipse" /></a> -->
            <a href="#" onclick="toggleShape(this, SHAPES.RECTANGLE);" class="rect">Draw Rectangle</a>
            <a href="#" onclick="toggleShape(this, SHAPES.LINE);" class="line">Draw Line</a>
            <a href="#" onclick="toggleShape(this, SHAPES.LABEL);" class="text">Add Label</a>
        </div>
        
        <input type="button" class="play button" name="n3-ui_play" value="Play Story" id="n3-ui_play" onclick="playStory();" />
        
        <input type="button" class="export button" name="n3-ui_export" value="Export Story" id="n3-ui_export" onclick="exportStory();" />
    </div>
    
    <div id="n3-ui_side_panel">
        
    </div>
    
    <div id="n3-ui_triggerDialog" title="Triggers">
        <ul>
            <li id="triggerTemplate" style="display: none;">
                <p>Trigger type: 
                <select class="trigger_type" onchange="chooseTrigger(this);">
                    <option value="">Select...</option>
                    <option value="state">State</option>
                    <!-- <option value="dom">Page Element</option> -->
                    <option value="timeline">Timeline</option>
                    <option value="delay">After previous delay</option>
                    <option value="or">Or</option>
                    <option value="and">And</option>
                </select>
                
                <a href="#" onclick="addSubTrigger(this);" class="add_sub_trigger" style="display: none;">Add</a>
                </p>
                
                <p class="state" style="display: none;">
                    <select class="where" onchange="$(this).nextAll('select.value').hide(); if($(this).val() != '') $(this).nextAll('select.value.' + $(this).val() + ':first').show();">
                        <option value="">Select state...</option>
                    </select>
                    
                    <select class="condition">
                        <option value="is">is</option>
                        <option value="not">not</option>
                        <option value="gt">&gt;</option>
                        <option value="gte">&gt;=</option>
                        <option value="lt">&lt;</option>
                        <option value="lte">&lt;=</option>
                    </select>
                    
                    <select class="value">
                        <option value="">Select value...</option>
                    </select>
                </p>
                
                <p class="dom" style="display: none;"><input type="button" class="on" value="Select element" /></p>
                
                <p class="timeline" style="display: none;">Elapsed time
                    <input type="hidden" class="where" value="elapsed" />
                    <select class="condition">
                        <option value="is">is</option>
                        <option value="not">not</option>
                        <option value="gt">&gt;</option>
                        <option value="gte">&gt;=</option>
                        <option value="lt">&lt;</option>
                        <option value="lte">&lt;=</option>
                    </select>
                    
                    <input type="text" class="value" value="" size="2" />ms
                </p>
                
                <p class="delay" style="display: none;"><input type="hidden" class="where" value="delay" /><input type="text" class="value" value="" size="2" />ms</p>
            </li>
    	<!-- <p>Please enter triggers for this member using n3 syntax.</p>
    	       <p><textarea name="triggers" id="triggers"></textarea></p>
    	       <p><input type="button" name="n3-ui_visSave" value="Save" id="n3-ui_visSave" onclick="saveTriggers();" /></p> -->
    </div>
    
    <div id="n3-ui_stylesDialog" title="Styles">
    	<p>The following styles are available for the selected annotation.</p>
    	
    	<p><span class="style_desc">Fill opacity and color:</span> <span id="fill_opacity"></span> <span id="fill_color"></span></p>
    	
    	<p><span class="style_desc">Border width and color:</span> <span id="stroke_width"></span> <span id="stroke_color"></span></p>
    </div>
    
    <div id="n3-ui_exportDialog" title="Export">
    	<p><textarea name="export" id="export"></textarea></p>
    </div>
</body>
</html>